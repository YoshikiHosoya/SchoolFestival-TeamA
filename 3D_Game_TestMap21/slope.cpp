// =====================================================================================================================================================================
//
// 坂の処理 [slope.cpp]
// Author : Sato Yoshiki
//
// =====================================================================================================================================================================
#include "slope.h"						// インクルードファイル
#include "manager.h"
#include "renderer.h"
#include "debugproc.h"

// =====================================================================================================================================================================
// 静的メンバ変数の初期化
// =====================================================================================================================================================================
LPDIRECT3DTEXTURE9 CSlope::m_pTexture = NULL;

// =====================================================================================================================================================================
// マクロ定義
// =====================================================================================================================================================================
#define TEXTURE_FILE00		"data/TEXTURE/Rock00.jpg"	// 読み込むテクスチャファイル名

#define SLOPE_SYZE_X		(30)						// 1ブロックの横のサイズ
#define SLOPE_SYZE_Y		(100)						// 1ブロックの縦のサイズ

// =====================================================================================================================================================================
//
// コンストラクタ
//
// =====================================================================================================================================================================
CSlope::CSlope() : CScene3D(PRIORITY_MODEL)
{
}

// =====================================================================================================================================================================
//
// デストラクタ
//
// =====================================================================================================================================================================
CSlope::~CSlope()
{
}

// =====================================================================================================================================================================
//
// 初期化処理
//
// =====================================================================================================================================================================
void CSlope::Init(void)
{
	m_size		= D3DXVECTOR3(0.0f, 0.0f, 0.0f);	 // サイズ
	m_fSlope	= 0.0f;							 //	傾斜

	// 初期化
	CScene3D::Init();
}

// =====================================================================================================================================================================
//
// 終了処理
//
// =====================================================================================================================================================================
void CSlope::Uninit(void)
{
	// 終了
	CScene3D::Uninit();
}

// =====================================================================================================================================================================
//
// 更新処理
//
// =====================================================================================================================================================================
void CSlope::Update(void)
{
	// 更新
	CScene3D::SetSlope(m_fSlope);
}

// =====================================================================================================================================================================
//
// 描画処理
//
// =====================================================================================================================================================================
void CSlope::Draw(void)
{
	// 描画
	CScene3D::Draw();
}

// =====================================================================================================================================================================
//
// 坂の生成
//
// =====================================================================================================================================================================
CSlope * CSlope::Create(D3DXVECTOR3 pos, float Slope)
{
	// 変数
	CSlope *pSlope;

	// メモリの確保
	pSlope = new CSlope();

	// 初期化
	pSlope->Init();

	// 両面カリングの設定
	pSlope->SetBothSideCulling(true);

	// 位置の設定
	pSlope->SetPos(D3DXVECTOR3(pos.x, pos.y, pos.z));

	// サイズ
	pSlope->m_size = D3DXVECTOR3(SLOPE_SYZE_X, 0.0f, SLOPE_SYZE_Y);

	// サイズの設定
	pSlope->SetSize(pSlope->m_size);

	// 斜面
	pSlope->m_fSlope = Slope;

	// 斜面の角度の設定
	pSlope->SetSlope(pSlope->m_fSlope);

	// 法線の設定
	pSlope->SetNormal();

	// テクスチャの割り当て
	pSlope->BindTexture(m_pTexture);

	// テクスチャの分割設定
	pSlope->SetTexSeparate(5);

	return pSlope;
}

// =====================================================================================================================================================================
//
// ロード
//
// =====================================================================================================================================================================
HRESULT CSlope::Load(void)
{
	// デバイスの取得
	LPDIRECT3DDEVICE9 pDevice = *CManager::GetRenderer()->GetDevice();

	// テクスチャ読み込み
	D3DXCreateTextureFromFile(pDevice, TEXTURE_FILE00, &m_pTexture);

	return S_OK;
}

// =====================================================================================================================================================================
//
// アンロード
//
// =====================================================================================================================================================================
void CSlope::Unload(void)
{
	// テクスチャの開放
	if (m_pTexture != NULL)
	{
		m_pTexture->Release();
		m_pTexture= NULL;
	}
}

// =====================================================================================================================================================================
//
// 斜面のサイズの設定
//
// =====================================================================================================================================================================
void CSlope::SetSlopSize(float Slope)
{
	m_fSlope = Slope;

	// 斜面の角度の設定
	SetSlope(m_fSlope);
}