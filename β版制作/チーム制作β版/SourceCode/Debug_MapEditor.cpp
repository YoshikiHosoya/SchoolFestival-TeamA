// =====================================================================================================================================================================
//
// デバッグ マップエディターの処理 [Debug_MapEditor.cpp]
// Author : Sato Yoshiki
//
// =====================================================================================================================================================================
#include "Debug_MapEditor.h"
#include "manager.h"
#include "renderer.h"
#include "player.h"
#include "inputKeyboard.h"
#include "fade.h"
#include "map.h"
#include "pause.h"
#include "ParticleManager.h"
#include "TexAnimation3D_Collision.h"
#include "item.h"
#include "UIManager.h"
#include "Scene.h"
#include "3Dline.h"

// =====================================================================================================================================================================
// 静的メンバ変数の初期化
// =====================================================================================================================================================================
CPlayer		*CDebugMapEditor::m_pPlayer		= NULL;
CMap		*CDebugMapEditor::m_pMap		= NULL;

// =====================================================================================================================================================================
// マクロ定義
// =====================================================================================================================================================================

// =====================================================================================================================================================================
//
// コンストラクタ
//
// =====================================================================================================================================================================
CDebugMapEditor::CDebugMapEditor()
{
}

// =====================================================================================================================================================================
//
// デストラクタ
//
// =====================================================================================================================================================================
CDebugMapEditor::~CDebugMapEditor()
{
}

// =====================================================================================================================================================================
//
// 初期化処理
//
// =====================================================================================================================================================================
HRESULT CDebugMapEditor::Init(void)
{
	// マップの生成
	m_pMap		= CMap::MapCreate(CMap::MAP_1);
	m_pPlayer	= CPlayer::Create();							// プレイヤーの生成
	// プレイヤーの位置設定
	m_pPlayer->SetPosition(D3DXVECTOR3(50.0f, 100.0f, 0.0f));

	// ポーズの生成
	m_pPause->CreatePause();
	//パーティクル生成
	CParticleManager::Create();

	// 更新を止める
	CScene::SetStopFlag(true);

	return S_OK;

}
// =====================================================================================================================================================================
//
// 終了処理
//
// =====================================================================================================================================================================
void CDebugMapEditor::Uninit(void)
{

}
// =====================================================================================================================================================================
//
// 更新処理
//
// =====================================================================================================================================================================
void CDebugMapEditor::Update(void)
{
	// マップの死亡フラグ確認関数
	m_pMap->UpdateDieFlag();

	// プレイヤーの開放
	if (m_pPlayer != nullptr /*&& m_pPlayer->GetLife() <= 0*/)
	{
		m_pPlayer->Rerease();
		m_pPlayer = nullptr;
	}
 }
// =====================================================================================================================================================================
//
// プレイヤーの取得
//
// =====================================================================================================================================================================
CPlayer * CDebugMapEditor::GetPlayer(void)
{
	if (m_pMap)
	{
		return m_pPlayer;
	}
	return nullptr;
}
// =====================================================================================================================================================================
//
// マップの取得
//
// =====================================================================================================================================================================
CMap * CDebugMapEditor::GetMap(void)
{
	if (m_pMap)
	{
		return m_pMap;
	}
	return nullptr;
}

// =====================================================================================================================================================================
//
// 描画処理
//
// =====================================================================================================================================================================
void CDebugMapEditor::Draw(void)
{
}

// =====================================================================================================================================================================
//
// デバッグ情報表記
//
// =====================================================================================================================================================================
void CDebugMapEditor::ShowDebugInfo(void)
{
	//キーボード情報取得
	CKeyboard *key = CManager::GetInputKeyboard();

	//使い方説明
	CDebugProc::Print("---------Debug Collision----------\n");
	CDebugProc::Print("[Ctrl] + テンキー [5] : 当たり判定のラインの表示非表示\n");

	if (C3DLine::GetDrawFlag())
	{
		CDebugProc::Print("デバッグ用当たり判定ラインを描画しています\n");
	}
	else
	{
		CDebugProc::Print("デバッグ用当たり判定ラインを描画していません\n");
	}

	// 当たり判定ラインの表示非表示
	if (key->GetKeyboardPress(DIK_LCONTROL))
	{// Ctrl + 5
		if (key->GetKeyboardTrigger(DIK_NUMPAD5))
		{
			if (C3DLine::GetDrawFlag())
			{// 表示中なら非表示
				C3DLine::SetDrawFlag(false);
			}
			else
			{// 非表示なら表示
				C3DLine::SetDrawFlag(true);
			}
		}
	}

	// マップの更新
	m_pMap->MapUpdate();
}